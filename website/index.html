<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Décentralized Cloud — Dashboard (MVP)</title>
  <style>
    /* ======= Basic CSS (responsive, simple) ======= */
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#7c3aed; --glass: rgba(255,255,255,0.03);
      --gap:16px; --radius:12px;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#071025); color:#e6eef8; -webkit-font-smoothing:antialiased;
    }
    .app{max-width:1200px;margin:24px auto;padding:18px;}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#4f46e5);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:20px;margin:0}
    p.subtitle{margin:0;color:var(--muted);font-size:13px}

    /* grid */
    .grid{display:grid;grid-template-columns: 320px 1fr 320px; gap:var(--gap)}
    @media (max-width:1000px){.grid{grid-template-columns:1fr;}}

    /* card */
    .card{background:var(--card);padding:14px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .card h3{margin:0 0 8px 0}
    .muted{color:var(--muted);font-size:13px}

    /* node list */
    .node{display:flex;align-items:center;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px}
    .node .left{display:flex;gap:10px;align-items:center}
    .dot{width:12px;height:12px;border-radius:50%}
    .dot.online{background:#22c55e}
    .dot.offline{background:#ef4444}

    /* files */
    .files-list{display:flex;flex-direction:column;gap:8px}
    .file{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}

    /* traffic chart placeholder */
    .chart{height:200px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;justify-content:center;color:var(--muted)}

    /* upload */
    .upload{display:flex;gap:8px}
    input[type=file]{flex:1}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    small{color:var(--muted)}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">DC</div>
      <div>
        <h1>Decentralized Cloud — Dashboard</h1>
        <p class="subtitle">Vue rapide des nœuds, trafic, fichiers et crédits</p>
      </div>
    </header>

    <main class="grid">
      <!-- Left column: Nodes + Credits -->
      <section class="card" id="left-col">
        <h3>Nodes</h3>
        <p class="muted">Liste des nœuds participants (uptime, espace)</p>
        <div id="nodes-list" style="margin-top:12px">
          <!-- Node items injected here -->
        </div>

        <hr style="border:none;height:12px">
        <h3>Credits</h3>
        <div id="credits" style="margin-top:8px">
          <p class="muted">Ton solde de crédits pour stockage</p>
          <div class="card" style="margin-top:8px;background:transparent;padding:10px">
            <strong id="credits-value">0 GB</strong>
            <div class="muted">Règle: 1Go donné = 1Go crédité (MVP)</div>
          </div>
        </div>
      </section>

      <!-- Middle column: Files + Traffic -->
      <section class="card" id="main-col">
        <h3>Fichiers</h3>
        <p class="muted">Les fichiers que tu as stockés</p>

        <div style="margin-top:12px" class="files-list" id="files-list">
          <!-- files injected here -->
        </div>

        <hr style="border:none;height:16px">
        <h3>Upload</h3>
        <div class="upload">
          <input id="file-input" type="file" />
          <button id="upload-btn">Upload</button>
        </div>
        <small id="upload-status"></small>

        <hr style="border:none;height:16px">
        <h3>Trafic (placeholder)</h3>
        <div class="chart" id="traffic-chart">Graphique trafic — (placeholder)</div>
      </section>

      <!-- Right column: Node details / actions -->
      <section class="card" id="right-col">
        <h3>Node Details</h3>
        <p class="muted">Sélectionnez un nœud pour voir les détails</p>
        <div id="node-details" style="margin-top:12px">Aucun nœud sélectionné</div>

        <hr style="border:none;height:16px">
        <h3>Actions</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button id="refresh-btn">Refresh data</button>
          <button id="simulate-btn">Simulate node (dev)</button>
        </div>
      </section>
    </main>

    <footer>
      Prototype — Frontend only. Routes API placées dans le fichier JS (placeholder).
    </footer>
  </div>

  <script>
    /* ====== PLACEHOLDER ROUTES ======
       Fill these routes with your backend endpoints (FastAPI) later.
       Example mapping:
         - /api/nodes -> GET nodes list
         - /api/nodes/heartbeat -> POST node heartbeat
         - /api/files -> GET files
         - /api/upload -> POST upload file
         - /api/traffic -> GET traffic stats
         - /api/credits -> GET credits
    */
    const API_ROUTES = {
      nodes: '/api/nodes',              // GET
      nodeRegister: '/api/nodes/register', // POST
      heartbeat: '/api/nodes/heartbeat', // POST
      files: '/api/files',              // GET
      upload: '/api/upload',            // POST (form-data)
      traffic: '/api/traffic',          // GET
      credits: '/api/credits'           // GET
    };

    // ======= Small helpers =======
    function el(html){const tmp=document.createElement('div');tmp.innerHTML=html.trim();return tmp.firstChild}

    // ======= Fetch stubs (fill with real fetch when backend ready) =======
    async function fetchNodes(){
      // Placeholder: return mock data now
      // Replace with: return fetch(API_ROUTES.nodes).then(r=>r.json())
      return [
        {id:'node-1', ip:'192.168.1.10', status:'online', free_space:120*1024*1024},
        {id:'node-2', ip:'192.168.1.11', status:'offline', free_space:50*1024*1024}
      ];
    }

    async function fetchFiles(){
      return [
        {id:'file-1', name:'photo.png', size:304512, node:'node-1'},
        {id:'file-2', name:'doc.pdf', size:1203456, node:'node-2'}
      ];
    }

    async function fetchCredits(){
      return {credits_gb: 5};
    }

    async function uploadFile(file){
      // Example how to call real endpoint:
      // const fd=new FormData(); fd.append('file', file);
      // return fetch(API_ROUTES.upload, {method:'POST', body:fd}).then(r=>r.json());

      // Placeholder: fake delay + success
      return new Promise((res)=>setTimeout(()=>res({ok:true, id:'file-new'}),1000));
    }

    // ======= UI rendering =======
    async function renderNodes(){
      const nodes = await fetchNodes();
      const root = document.getElementById('nodes-list'); root.innerHTML='';
      nodes.forEach(n=>{
        const nodeEl = el(`<div class="node"><div class="left"><div class="dot ${n.status==='online'? 'online':'offline'}"></div><div><strong>${n.id}</strong><div class="muted">${n.ip}</div></div></div><div class="muted">Free: ${Math.round(n.free_space/1024/1024)} MB</div></div>`);
        nodeEl.addEventListener('click', ()=>selectNode(n));
        root.appendChild(nodeEl);
      });
    }

    async function renderFiles(){
      const files = await fetchFiles();
      const root = document.getElementById('files-list'); root.innerHTML='';
      files.forEach(f=>{
        const fileEl = el(`<div class="file"><div><strong>${f.name}</strong><div class="muted">${Math.round(f.size/1024)} KB — on ${f.node}</div></div><div><button data-id="${f.id}">Download</button></div></div>`);
        root.appendChild(fileEl);
      });
    }

    async function renderCredits(){
      const c = await fetchCredits();
      document.getElementById('credits-value').innerText = c.credits_gb + ' GB';
    }

    function selectNode(node){
      const d = document.getElementById('node-details');
      d.innerHTML = `<div><strong>${node.id}</strong><div class="muted">${node.ip}</div><div class="muted">Status: ${node.status}</div><div class="muted">Free: ${Math.round(node.free_space/1024/1024)} MB</div></div>`;
    }

    // ======= Event wiring =======
    document.getElementById('refresh-btn').addEventListener('click', ()=>{ renderAll(); });
    document.getElementById('simulate-btn').addEventListener('click', ()=>{ alert('Simulation: node created (dev)') });
    document.getElementById('upload-btn').addEventListener('click', async ()=>{
      const input = document.getElementById('file-input');
      if(!input.files.length) return alert('Choisis un fichier');
      const file = input.files[0];
      document.getElementById('upload-status').innerText = 'Uploading...';
      const res = await uploadFile(file);
      document.getElementById('upload-status').innerText = res.ok ? 'Upload OK' : 'Upload failed';
      await renderFiles();
    });

    async function renderAll(){
      await Promise.all([renderNodes(), renderFiles(), renderCredits()]);
    }

    // Initial render
    renderAll();
  </script>
</body>
</html>